# NixieClock

Для более точной работы часов желательно подключить пин SQW модуля DS3231 к пину ардуино D2, если у вас модуль DS3231mini, то необходимо найти 3-ю ножку микросхемы и также проводком подпаять к пину D2. Бузер будет подключаться к пину D13 также через резистор. Штатный резистор бузера необходимо выпаять с платы(если он имеется).

Если нет возможности подключить пин SQW или по какой-то причине нету от него сигнала, то часы при старте перейдут на внутренний источник тактирования. Если по какой-то причине нет ответа от модуля часов или нет сигнала с пина SQW, при старте часов будет длинный писк.

Если у вас установлена неоновая точка вместо светодиодной, то необходимо перед прошивкой установить в "config" - NEON_DOT 1.
Так-же не забудьте выбрать свою плату, в "config" - BOARD_TYPE. Для других плат на 4 лампы используйте -  BOARD_TYPE 3, на 6 ламп -  BOARD_TYPE 4.

Датчики температуры DHT11/12, DHT21/22, DS18B20 подключаются к пину D1 с подтяжкой 4.7-10кОм к +5в.
Датчик температуры BME(BMP)180/280 подключается к пинам A4 и A5 параллельно модулю часов.

Для сброса настроек необходимо зажать среднюю кнопку и подать питание на часы.
Для одиночного запуска часов с настройками по умолчанию необходимо зажать левую кнопку и подать питание на часы.
Для запуска теста системы(ламп тест) необходимо зажать правую кнопку и подать питание на часы.


Что нового:

        ver 1.0.0

    Возможность создавать/удалять будильники(у каждого индивидуальные настройки)
    Возможность создавать свои мелодии для будильника.
    Добавлен режим рандомного эффекта.
    Добавлено отображения температуры/влажности/давления(поддерживаемые датчики - DS3231(встроенный), BME/BMP_280(180), DHT11/12, DHT21/22(AM2301), DS18B20).
    Новая анимация антиотравления.
    Добавлен аварийный режим работы - если по какой-то причине модуль RTC перестанет отвечать, то при старте часов прозвучит долгий писк и часы перейдут на внутреннее тактирование.

         ver 1.1.0

    Новое меню настроек будильника.

         ver 1.2.0

    Добавлена возможность подключения адресных светодиодов WS2812B вместо обычных светодиодов подсветки.
    Доступно 7 цветов подсветки.

         ver 1.2.1

    Исправление выбора мелодий будильника.
    Добавлен выбор подтяжки питания кнопок.

        ver 1.2.2

    Добавлена возможность выбрать использование только одного будильника, параметр - USE_ONE_ALARM.
    Добавлена коррекция хода модуля часов/внутреннего источника, пункт меню 8.

        ver 1.2.3

    Добавлено автоматическое отображение температуры(параметры - DEFAULT_AUTO_TEMP_TIME, AUTO_TEMP_PAUSE_TIME, AUTO_TEMP_ANIM_TIME).
    Добавлено 3 звука будильника.
    Добавлена поддержка аналоговых кнопок(тип кнопок - ANALOG).
    Добавлено автоматическое определение наличия сигнала SQW и доступности модуля RTC.

        ver 1.3.0

    Добавлено 3 новых эффекта перехода времени - волна, блики, испарение.
    Добавлено 5 эффектов для подсветки на адресных светодиодах - дыхание, дыхание со сменой цвета, плавная смена, радуга, рандомные цвета.

        ver 1.3.1

    Добавлена проверка контрольной суммы настроек.

        ver 1.4.2

    Добавлена поддержка часов с 6-ю лампами.
    Доработана динамическая индикация.
    Добавлен тест системы(ламп тест)(удержание правой кнопки при подаче питания).

         
Что планируется:

    Добавить возможность установки обратной связи на делителе напряжения для ВВ преобразователя.
    Добавить меню отладки для настройки преобразователя с кнопок.
    Добавить таймер/секундомер.
    Добавить иное поведение точки при включенном будильнике.


Управление:
Настройка времени: Удерживать "левую" кнопку

    Средняя кнопка - выбор, остальные "меньше" и "больше"
    Клик по "выбору" - смена настройки часы/минуты | месяц/дата | год
    Клик "меньше" или "больше" - изменение времени/даты
    Удержать "выбор" - возврат к режиму часов
    
Настройка будильника:  Удерживать "правую" кнопку

Настройка будильников "USE_ONE_ALARM 0":

В режиме часов удержание правой клавиши – переход к настройке будильников.
   После входа в настройку:

       В левых двух разрядах отображается текущий номер будильника (0 – нет будильников).
       В крайнем правом разряде отображается текущий режим будильника (если будильников нет –      ничего не отображается).

Экран «Выбор номера и режима будильника»
   Нажатие на:

         Правую клавишу – увеличивает значение.
         Левую клавишу – уменьшает значение.
         Среднюю клавишу -  переводит управление по кругу («Выбор будильника» -> «Режим будильника»).

   Удержание:

    Правой клавиши –
    (курсор на «режим будильника») - переход к экрану настройки дней недели/мелодии.
    (курсор на «номер будильника») - добавить новый будильник.
    Левой клавиши –
    (курсор на «режим будильника») - переход к экрану настройки времени будильника.
    (курсор на «номер будильника») – удалить текущий будильник будильника.
    Средней клавиши – выход к режиму часов.

После перехода в настройку дней недели/мелодии:

       В первом разряде отображается текущий день недели (если режим будильника <4 - ничего не отображается).
       Во втором разряде отображается активация дня недели (если режим будильника <4 - ничего не отображается).
       В третьем и четвертом разряде отображается текущая мелодия будильника.

Экран «Настройка дней недели/мелодии»
   Нажатие на:

         Правую клавишу – увеличивает значение.
         Левую клавишу – уменьшает значение.
         Среднюю клавишу -  переводит управление по кругу («День недели» -> «Активация дня недели»), если курсор на выборе мелодии - переводит обратно к выбору дня недели.

   Удержание:

        Правой клавиши – переход к экрану настройке мелодии.
        Левой клавиши – переход к экрану настройки времени будильника.
        Средней клавиши – выход к выбору режима будильника.

После перехода в настройку времени будильника:

       В первом и втором разряде отображается время в часах.
       В третьем и четвертом разряде отображается время в минутах.

Экран «Настройка времени будильника»
   Нажатие на:

         Правую клавишу – увеличивает значение.
         Левую клавишу – уменьшает значение.
         Среднюю клавишу -  переводит управление по кругу («ЧЧ» -> «ММ»).

   Удержание:

        Правой клавиши – переход к экрану настройки дней недели/мелодии.
        Левой клавиши –   переход к экрану настройки времени будильника.
        Средней клавиши – выход к выбору режима будильника.

Настройка будильника "USE_ONE_ALARM 1":

В режиме часов удержание правой клавиши – переход к настройке будильников.
   После входа в настройку:

    Средняя кнопка - выбор, остальные "меньше" и "больше"
    Клик по "выбору" - перемещение по индикаторам
    Клик "меньше" или "больше" - изменение времени/режима/дня недели/активации/мелодии
    Удержать "меньше" или "больше" - смена настройки часы/минуты | режим | день недели/активация | мелодия
    Удержать "выбор" - возврат к режиму часов

Как добавить свои мелодии будильника:

Для начала нужно создать новый массив мелодии и прописать его в основном массиве всех мелодий:

    const uint16_t _sound_2[][3] PROGMEM = { //массив семплов 2-й мелодии будильника || семпл - частота(10..10000)(Hz) | длительность звука(50..500)(ms) | длительность паузы(50..1000)(ms)
    };

    const uint16_t alarm_sound[][2] = {  //массив мелодий будильника
      {(uint16_t)&_sound_1, sizeof(_sound_1) / 6},
      {(uint16_t)&_sound_2, sizeof(_sound_2) / 6}
    };

Затем в массив добавить патерны:

    const uint16_t _sound_2[][3] PROGMEM = { //массив семплов 2-й мелодии будильника || семпл - частота(10..10000)(Hz) | длительность звука(50..500)(ms) | длительность паузы(50..1000)(ms)
       {392, 700, 700}, //можно добавлять n-е количество
    };

Патерн состоит из 3-х значений:

    const uint16_t _sound_2[][3] PROGMEM = { //массив семплов 2-й мелодии будильника || семпл - частота(10..10000)(Hz) | длительность звука(50..500)(ms) | длительность паузы(50..1000)(ms)
    {/*Частота звука*/, /*Длительность звука*/, /*Пауза звука*/},
    };

    Частота звука(в герцах)
    Длительность звука(в мс)
    Пауза звука между патернами(в мс):
    Если равно длительности звука: паузы не будет.
    Если больше: пауза звука = (пауза звука - длительность звука).

Режимы будильника:

    00 - выключен
    01 - однократный
    02 - каждый день
    03 - по будням
    04 - выбор по дням недели

  Основные настройки:  Удерживать "среднюю" кнопку

    Средняя кнопка - выбор, остальные "меньше" и "больше"
    Клик по "выбору" - переход в пункт меню для настройки/выход к выбору пункта меню
    Клик "меньше" или "больше" - выбор пункта меню
    Удержать "выбор" - возврат к режиму часов

  Пункты меню:

    1 - Формат времени (12ч | 24ч)
    2 - Глюки вкл/выкл (0 - выкл | 1 - вкл)
    3 - Звук кнопок вкл/выкл (0 - выкл | 1 - вкл)
    4 - Время звука смены часа(Начало : Конец)
    5 - Время смены подсветки(Ночь : День)
    6 - Яркость индикаторов(Ночь : День)
    7 - Настройка датчика температуры(Коррекция : Сенсор)
    8 - Настройка интервала автоматического отображения температуры(время в секундах 0..240)
    9 - коррекция хода часов DS3231(слева - отрицательное значение(-1..-127), справа - положительное значение(0..127))
    9 - коррекция хода внутреннего осциллятора(коррекция (2000..2800)(мкс))

Управление кнопками В РЕЖИМЕ ЧАСОВ:
Клик по "правой" кнопке отображает текущую дату, затем клик по "правой" кнопке переключает дату/год.

Клик по "средней" кнопке отображает текущий режим подсветки.

    Клик по "правой" кнопке - переключает режим анимации цифр(0 - выкл, 1 - рандомная смена эффектов, 2 - плавное угасание и появление , 3 - перемотка по порядку числа, 4 - перемотка по порядку катодов в лампе, 5 - поезд, 6 - резинка, 7 - волна, 8 - блики, 9 - испарение)
    Клик по "средней" кнопке(для обычных светодиодов) - переключает режим подсветки(0 - выкл | 1 - статичная | 2 - динамичная(дыхание)
    Клик по "средней" кнопке(для адресных светодиодов) - переключает режим подсветки(0 - выкл | 1..7 - статичные цвета(удержание средней кнопки - вкл/выкл режим дыхания) | 8 - дыхание со сменой цвета при затухании | 9 - плавная смена цвета | 10 - радуга | 11 - рандомные цвета)
    Клик по "левой" кнопке - переключает режим точек(0 - выкл | 1 - статичная | 2 - динамичная(плавно мигает)

Клик по "левой" кнопке отображает текущую температуру, затем клик по "левой" кнопке переключает температуру/давление/влажность.
